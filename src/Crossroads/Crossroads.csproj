<Project Sdk="Microsoft.NET.Sdk">
	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<PublishReadyToRun>true</PublishReadyToRun>
		<RootNamespace>Crossroads</RootNamespace>
		<AssemblyName>Crossroads</AssemblyName>
		<Configuration>Debug</Configuration>
		<VersionPrefix>1.0.0-preview</VersionPrefix>
		<PackageId>MorganStanley.Crossroads</PackageId>
		<Company>MorganStanley</Company>
		<Product>Crossroads</Product>
		<Description>Crossroads is a dotnet core commandline tool packager for developers. This is a generic solution to host any application within Crossroads package executable and further launches application's executable. Developers will specify arguments such as name, icon, version etc for branding during the package generation. The specified argument name will be used to rebrand the internal application.</Description>
		<RepositoryUrl>https://github.com/morganstanley/Crossroads</RepositoryUrl>
		<Authors>MorganStanley</Authors>
		
		<SelfContained>false</SelfContained>
		<UseAppHost>true</UseAppHost>
	
		<PackAsTool>true</PackAsTool>
		<ToolCommandName>crossroads</ToolCommandName>
		<PackageOutputPath>./nupkg</PackageOutputPath>
	
		<ErrorOnDuplicatePublishOutputFiles>false</ErrorOnDuplicatePublishOutputFiles>
	
		<TargetFramework>netcoreapp3.1</TargetFramework>
	</PropertyGroup>
	<ItemGroup>
		<PackageReference Include="Microsoft.Extensions.Hosting" Version="3.1.5" />
		<PackageReference Include="Microsoft.Extensions.Configuration" Version="3.1.7" />
		<PackageReference Include="System.CommandLine.Hosting" Version="0.3.0-alpha.20574.7" />
		<PackageReference Include="System.IO.Abstractions" Version="3.0.2" />
		<PackageReference Include="Microsoft.CodeAnalysis.CSharp" Version="3.5.0" />
		<PackageReference Include="Microsoft.CodeAnalysis.Analyzers" Version="3.0.0" />
		<PackageReference Include="Newtonsoft.Json" Version="12.0.3" />
		<PackageReference Include="System.CommandLine.Hosting" Version="0.3.0-alpha.20574.7" />
		<PackageReference Include="System.IO.Abstractions" Version="3.0.2" />
		<PackageReference Include="Microsoft.Extensions.DependencyModel" Version="2.1.0" />
		<PackageReference Include="Microsoft.NET.HostModel" Version="3.1.6" />
		<PackageReference Include="GitVersion.MsBuild" Version="5.8.1">
			<PrivateAssets>all</PrivateAssets>
			<IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
		</PackageReference>
	</ItemGroup>
	<ItemGroup>
		<None Update="appsettings.json">
			<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
		</None>
	</ItemGroup>

	<Target Name="CopyAppHost" BeforeTargets="CopyAdditionalFiles" DependsOnTargets="ResolveFrameworkReferences">
		<ItemGroup>
			<None Include="$(AppHostSourcePath)">
				<Link>apphost\apphost.exe</Link>
				<CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
			</None>
		</ItemGroup>
	</Target>

<Target Name="CopyBuildFiles" AfterTargets="Build">
    <ItemGroup>
      <BuildFiles Include=".\$(OutDir)*.*"/>
    </ItemGroup>
    <Copy SourceFiles="@(BuildFiles)" DestinationFolder=".\$(OutDir)LauncherFiles"/>
</Target>
 
 	<ItemGroup Label="Packaging">
      <Content Include=".\$(OutDir)LauncherFiles/*">
		  <Pack>true</Pack>
		  <PackagePath>.\$(OutDir)LauncherFiles</PackagePath>
		  <IncludeInPackage>true</IncludeInPackage>
		  <PackageCopyToOutput>true</PackageCopyToOutput>
		  <BuildAction>Content</BuildAction>
		  <CopyToOutputDirectory>Always</CopyToOutputDirectory>
		  <CopyToPublishDirectory>Always</CopyToPublishDirectory>
	  </Content>
	
	  <Content Include=".\$(OutDir)apphost\*">
		  <Pack>true</Pack>
		  <PackagePath>.\$(OutDir)apphost</PackagePath>
		  <IncludeInPackage>true</IncludeInPackage>
		  <PackageCopyToOutput>true</PackageCopyToOutput>
		  <BuildAction>Content</BuildAction>
		  <CopyToOutputDirectory>Always</CopyToOutputDirectory>
		  <CopyToPublishDirectory>Always</CopyToPublishDirectory>
	  </Content>
	</ItemGroup>
  
  <Target Name="CleanLauncherDirectory" AfterTargets="Clean">
    <RemoveDir Directories=".\$(OutDir)LauncherFiles"  />
  </Target>
</Project>
